# Base configuration: 17-country Europe subset, 70 nodes, single-day time horizon
# Contains all SHARED settings across technology scenarios (geography, clustering, time, solver)
# Layer scenario-specific tech restrictions on top via scenario configs
#
# Usage:
#   snakemake --configfile config/base-europe17-70n-day.yaml \
#             --configfile config/scenarios/scenario-<name>.yaml
#
# Naming convention: base-{region}{countries}-{clusters}n-{time}.yaml

version: 0.8.0
foresight: overnight
tutorial: false

results_dir: results/
summary_dir: results/

# ============================================================================
# GEOGRAPHIC SCOPE (shared across all scenarios)
# ============================================================================
regions: ["europe"]
countries:
  - "AT"  # Austria
  - "BG"  # Bulgaria
  - "CZ"  # Czech Republic
  - "DE"  # Germany
  - "DK"  # Denmark
  - "ES"  # Spain
  - "FR"  # France
  - "GB"  # United Kingdom
  - "GR"  # Greece
  - "HU"  # Hungary
  - "IT"  # Italy
  - "PL"  # Poland
  - "PT"  # Portugal
  - "RO"  # Romania
  - "RS"  # Serbia
  - "SE"  # Sweden

# ============================================================================
# CLUSTERING (shared across all scenarios)
# ============================================================================
scenario:
  simpl: [""]
  ll: ["copt"]
  clusters: [70]  # 70 total nodes distributed across 17 countries
  opts:
    - "Co2L-3h"  # CO2 limit + 3-hour time resolution

# Clustering options for controlling node distribution
# PyPSA-Earth will use focus_weights to distribute clusters proportionally across countries
cluster_options:
  distribute_clusters: ["load"]  # Distribute clusters based on electricity load
  focus_weights:
    DE: 0.1558  # Germany: ~11 nodes
    FR: 0.1840  # France: ~13 nodes
    GB: 0.1563  # UK: ~11 nodes
    IT: 0.1556  # Italy: ~11 nodes
    ES: 0.1099  # Spain: ~8 nodes
    PL: 0.0883  # Poland: ~6 nodes
    SE: 0.0168  # Sweden: ~1 node
    DK: 0.0138  # Denmark: ~1 node
    AT: 0.0206  # Austria: ~1 node
    BG: 0.0112  # Bulgaria: ~1 node
    CZ: 0.0187  # Czech Republic: ~1 node
    GR: 0.0150  # Greece: ~1 node
    HU: 0.0150  # Hungary: ~1 node
    PT: 0.0131  # Portugal: ~1 node
    RO: 0.0168  # Romania: ~1 node
    RS: 0.0090  # Serbia: ~1 node
    # Total: 0.9999 <= 1.0 (normalized)

# Legacy focus_weights at root level for backwards compatibility (will be deprecated)
# Kept here as fallback - cluster_options.focus_weights takes precedence
focus_weights:
  DE: 0.1558
  FR: 0.1840
  GB: 0.1563
  IT: 0.1556
  ES: 0.1099
  PL: 0.0883
  SE: 0.0168
  DK: 0.0138
  AT: 0.0206
  BG: 0.0112
  CZ: 0.0187
  GR: 0.0150
  HU: 0.0150
  PT: 0.0131
  RO: 0.0168
  RS: 0.0090

# ============================================================================
# TIME HORIZON (shared across all scenarios)
# ============================================================================
snapshots:
  start: "2013-01-01 00:00"
  end: "2013-01-02 00:00"
  inclusive: "left"

# ============================================================================
# DATA RETRIEVAL (shared across all scenarios)
# ============================================================================
enable:
  retrieve_databundle: true
  retrieve_databundle_sector: false
  retrieve_cost_data: true
  download_osm_data: true
  build_natura_raster: false
  build_cutout: false

# ============================================================================
# WEATHER DATA (shared across all scenarios)
# ============================================================================
atlite:
  nprocesses: 4
  cutouts:
    cutout-2013-era5:
      module: era5
      dx: 0.3
      dy: 0.3
      time: ["2013-01-01", "2013-01-02"]
  default_cutout: cutout-2013-era5

# ============================================================================
# LOAD DATA (shared across all scenarios)
# ============================================================================
load_options:
  ssp: "ssp2-2.6"
  weather_year: 2013
  prediction_year: 2030
  scale: 1

# ============================================================================
# SOLVER SETTINGS (shared across all scenarios)
# ============================================================================
solving:
  options:
    formulation: kirchhoff
    load_shedding: 500.  # EUR/MWh penalty for unserved load
    noisy_costs: false
    clip_p_max_pu: 0.01
    min_iterations: 1
    max_iterations: 2
    skip_iterations: true
    track_iterations: false
    # NOTE: extra_functionality is scenario-specific and should be overridden
  solver:
    name: gurobi
    options: gurobi-default
  mem: 24000

# ============================================================================
# CONSTRAINTS (can be overridden in scenarios)
# ============================================================================
global_constraints:
  - name: CO2LimitZero
    sense: "<="
    type: "primary_energy"
    carrier_attribute: "co2_emissions"
    constant: 0.0

# ============================================================================
# MISC SETTINGS
# ============================================================================
logging:
  level: INFO

plotting:
  map:
    boundaries: [-11.0, 30.0, 34.0, 72.0]
    figsize: [7, 7]
